ARG CODE_VERSION
FROM clipper/lib_base:${CODE_VERSION}

# Build Clipper

RUN cd /clipper/src/libs/spdlog \
    && git apply ../patches/make_spdlog_compile_linux.patch \
    && cd /clipper \
    && ./configure --cleanup-quiet \
    && ./configure --release

COPY ./src /clipper/src

RUN cd /clipper/release \
    && make query_frontend

ENTRYPOINT ["/clipper/release/src/frontends/query_frontend"]

# vim: set filetype=dockerfile:
